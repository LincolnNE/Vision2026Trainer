<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmos.so ì´ë¯¸ì§€ ë¶„ë¥˜ ê´€ë¦¬ì v1.0</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f5f5f7; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .panel { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: 500; }
        .status.connected { background: #d4edda; color: #155724; }
        .status.disconnected { background: #f8d7da; color: #721c24; }
        .btn { background: #007AFF; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; margin: 5px; }
        .btn:hover { background: #0056CC; }
        .btn.danger { background: #FF3B30; }
        .btn.success { background: #34C759; }
        .input-group { margin: 10px 0; }
        .input-group input, .input-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        .image-list { max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; }
        .image-item { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .image-item:hover { background: #f8f9fa; }
        .image-item.selected { background: #e3f2fd; }
        .category-display { font-size: 12px; color: #666; margin-top: 5px; }
        .loading { text-align: center; padding: 20px; color: #666; }
        .error { color: #FF3B30; background: #ffe6e6; padding: 10px; border-radius: 8px; margin: 10px 0; }
        .success { color: #34C759; background: #e6ffe6; padding: 10px; border-radius: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒŒ Cosmos.so ì´ë¯¸ì§€ ë¶„ë¥˜ ê´€ë¦¬ì v1.0</h1>
            <p>Gemini API ì§ì ‘ ì—°ë™ - ì›¹ ê¸°ë°˜ GUI</p>
            <div id="api-status" class="status disconnected">API ì—°ê²° í™•ì¸ ì¤‘...</div>
        </div>

        <div class="panel">
            <h3>ğŸ“¸ ì´ë¯¸ì§€ ê´€ë¦¬</h3>
            <div class="input-group">
                <input type="url" id="image-url" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥">
                <button class="btn" onclick="addImage()">ì´ë¯¸ì§€ ì¶”ê°€</button>
            </div>
            <div class="input-group">
                <textarea id="bulk-urls" placeholder="ì—¬ëŸ¬ URLì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥"></textarea>
                <button class="btn" onclick="addBulkImages()">ì¼ê´„ ì¶”ê°€</button>
            </div>
        </div>

        <div class="panel">
            <h3>ğŸ¤– AI ë¶„ì„</h3>
            <button class="btn success" onclick="analyzeAll()">ì „ì²´ ë¶„ì„ ì‹œì‘</button>
            <div id="analysis-progress" style="display: none;" class="loading">ë¶„ì„ ì§„í–‰ ì¤‘...</div>
        </div>

        <div class="panel">
            <h3>ğŸ“‹ ì´ë¯¸ì§€ ëª©ë¡</h3>
            <div id="image-list" class="image-list">
                <div class="loading">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
        </div>

        <div class="panel">
            <h3>ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
            <button class="btn" onclick="saveCSV()">CSV ì €ì¥</button>
            <button class="btn" onclick="loadCSV()">CSV ë¡œë“œ</button>
        </div>
    </div>

    <script>
        let selectedImages = new Set();
        
        // API ìƒíƒœ í™•ì¸
        async function checkAPIStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                const statusEl = document.getElementById('api-status');
                
                if (data.gemini_available && data.api_key_set) {
                    statusEl.textContent = 'âœ… Gemini API ì—°ê²°ë¨';
                    statusEl.className = 'status connected';
                } else {
                    statusEl.textContent = 'âŒ Gemini API ì—°ê²° ì‹¤íŒ¨';
                    statusEl.className = 'status disconnected';
                }
            } catch (error) {
                document.getElementById('api-status').textContent = 'âŒ ì—°ê²° ì˜¤ë¥˜';
                document.getElementById('api-status').className = 'status disconnected';
            }
        }
        
        // ì´ë¯¸ì§€ ì¶”ê°€
        async function addImage() {
            const url = document.getElementById('image-url').value.trim();
            if (!url) return;
            
            try {
                const response = await fetch('/api/images', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const data = await response.json();
                if (response.ok) {
                    showMessage(data.message, 'success');
                    document.getElementById('image-url').value = '';
                    loadImages();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('ì´ë¯¸ì§€ ì¶”ê°€ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // ì¼ê´„ ì¶”ê°€
        async function addBulkImages() {
            const urls = document.getElementById('bulk-urls').value.trim().split('\n').filter(url => url.trim());
            if (urls.length === 0) return;
            
            try {
                const response = await fetch('/api/images/bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ urls })
                });
                
                const data = await response.json();
                showMessage(data.message, 'success');
                document.getElementById('bulk-urls').value = '';
                loadImages();
            } catch (error) {
                showMessage('ì¼ê´„ ì¶”ê°€ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // ì´ë¯¸ì§€ ëª©ë¡ ë¡œë“œ
        async function loadImages() {
            try {
                const response = await fetch('/api/images');
                const data = await response.json();
                
                const listEl = document.getElementById('image-list');
                if (data.urls.length === 0) {
                    listEl.innerHTML = '<div class="loading">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                    return;
                }
                
                listEl.innerHTML = data.urls.map((url, index) => `
                    <div class="image-item" data-index="${index}">
                        <div>
                            <div><strong>${index + 1}.</strong> ${url.substring(0, 60)}${url.length > 60 ? '...' : ''}</div>
                            <div class="category-display">${data.categories[index] || 'ë¶„ì„ ëŒ€ê¸°'}</div>
                        </div>
                        <div>
                            <button class="btn" onclick="analyzeImage(${index})">ë¶„ì„</button>
                            <button class="btn danger" onclick="deleteImage(${index})">ì‚­ì œ</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showMessage('ì´ë¯¸ì§€ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // ë‹¨ì¼ ì´ë¯¸ì§€ ë¶„ì„
        async function analyzeImage(index) {
            try {
                const response = await fetch(`/api/analyze/${index}`, { method: 'POST' });
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`ì´ë¯¸ì§€ ${index + 1} ë¶„ì„ ì™„ë£Œ`, 'success');
                    loadImages();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('ë¶„ì„ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // ì „ì²´ ë¶„ì„
        async function analyzeAll() {
            const progressEl = document.getElementById('analysis-progress');
            progressEl.style.display = 'block';
            
            try {
                const response = await fetch('/api/analyze/batch', { method: 'POST' });
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('ì „ì²´ ë¶„ì„ ì™„ë£Œ', 'success');
                    loadImages();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('ì „ì²´ ë¶„ì„ ì‹¤íŒ¨: ' + error.message, 'error');
            } finally {
                progressEl.style.display = 'none';
            }
        }
        
        // ì´ë¯¸ì§€ ì‚­ì œ
        async function deleteImage(index) {
            if (!confirm('ì´ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch(`/api/images/${index}`, { method: 'DELETE' });
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(data.message, 'success');
                    loadImages();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // CSV ì €ì¥
        async function saveCSV() {
            try {
                const response = await fetch('/api/csv/save', { method: 'POST' });
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(data.message, 'success');
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('CSV ì €ì¥ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // CSV ë¡œë“œ
        async function loadCSV() {
            const filename = prompt('ë¡œë“œí•  CSV íŒŒì¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš”:', 'dataset/full_data.csv');
            if (!filename) return;
            
            try {
                const response = await fetch('/api/csv/load', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ filename })
                });
                
                const data = await response.json();
                if (response.ok) {
                    showMessage(data.message, 'success');
                    loadImages();
                } else {
                    showMessage(data.error, 'error');
                }
            } catch (error) {
                showMessage('CSV ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const messageEl = document.createElement('div');
            messageEl.className = type;
            messageEl.textContent = message;
            messageEl.style.position = 'fixed';
            messageEl.style.top = '20px';
            messageEl.style.right = '20px';
            messageEl.style.zIndex = '1000';
            messageEl.style.maxWidth = '300px';
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                document.body.removeChild(messageEl);
            }, 3000);
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            checkAPIStatus();
            loadImages();
            
            // Enter í‚¤ë¡œ ì´ë¯¸ì§€ ì¶”ê°€
            document.getElementById('image-url').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addImage();
                }
            });
        });
    </script>
</body>
</html>